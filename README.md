# 电子书章节拆分工具

一个基于 Web 的工具，用于将 PDF 和 EPUB 格式的电子书按章节拆分，统一导出为 PDF 格式。

## ✨ 功能特性

### 核心功能
- ✅ **多格式支持**：支持 PDF 和 EPUB 格式
- ✅ **智能章节识别**：自动识别书籍章节（基于目录/大纲）
- ✅ **层级章节导出**：支持父子章节的层级结构
- ✅ **统一 PDF 输出**：所有格式统一导出为 PDF（EPUB 自动转换）
- ✅ **章节预览**：鼠标悬停即可预览章节内容
- ✅ **灵活导出模式**：
  - 分别导出：每个章节单独导出为 PDF
  - 合并导出：父章节与子章节合并为一个 PDF
  - 全局合并：全选时可将所有章节合并为一个文件

### 用户体验
- ✅ 拖拽上传文件
- ✅ 可视化层级章节列表
- ✅ 批量选择与导出
- ✅ 实时进度显示
- ✅ 层级文件名（如：01_第一篇_第一章.pdf）
- ✅ 纯前端处理，保护隐私
- ✅ 响应式设计，支持移动端

## 技术栈

- **前端框架**: React + TypeScript
- **构建工具**: Vite
- **样式**: TailwindCSS
- **PDF 处理**:
  - `pdf-lib` - PDF 拆分
  - `pdfjs-dist` - PDF 解析
  - `jspdf` - PDF 生成
- **EPUB 处理**:
  - `jszip` - ZIP 文件处理
  - `epubjs` - EPUB 解析
  - `html2canvas` - HTML 转图片

## 快速开始

### 安装依赖

```bash
npm install
```

### 开发模式

```bash
npm run dev
```

访问 http://localhost:5173 查看应用。

### 构建生产版本

```bash
npm run build
```

### 预览生产构建

```bash
npm run preview
```

### 环境要求

- Node.js 18.x 或更高版本
- 自动构建命令：`npm run build`
- 输出目录：`dist`

## 📖 使用说明

### 1. 上传文件
- 点击上传区域选择文件，或直接拖拽文件到上传区域
- 支持的格式：PDF、EPUB
- 文件大小限制：100MB
- 上传后自动解析章节结构

### 2. 选择章节
- 文件上传后会自动识别章节层级结构
- **单选/多选**：点击复选框选择章节
- **全选**：一键选择所有章节
- **层级选择**：选择父章节时自动选择所有子章节
- **章节预览**：鼠标悬停在章节标题上可预览内容

### 3. 配置导出模式

#### 分别导出模式（默认）
- 每个选中的章节导出为单独的 PDF 文件
- 支持父章节与子章节分别导出
- 可为单个父章节标记"合并"，将其子章节合并导出

#### 全局合并模式（全选时可用）
- 将所有选中章节合并为一个 PDF 文件
- 适合制作完整的章节合集

### 4. 导出章节
- **单个章节**：直接下载 PDF 文件
- **多个章节**：自动打包为 ZIP 文件下载
- **文件命名**：自动生成层级文件名（如：01_第一篇_01_第一章.pdf）
- **进度提示**：实时显示导出进度和当前处理的章节
- **格式转换**：EPUB 章节自动转换为 PDF 格式

## ⚠️ 注意事项

### 文件要求
- **PDF 文件**：必须包含目录信息（Outline/Bookmarks）才能自动识别章节
- **EPUB 文件**：必须包含导航文件（toc.ncx 或 nav.xhtml）才能识别章节
- **文件大小**：建议不超过 100MB，过大文件可能导致浏览器性能问题

### 技术说明
- 所有处理都在浏览器中完成，**不会上传到服务器**，保护您的隐私
- PDF.js Worker 使用本地打包版本，确保离线可用
- EPUB 转 PDF 使用 html2canvas + jsPDF，质量为 85% 以减小文件大小

### 浏览器兼容性
- 建议使用现代浏览器：Chrome、Firefox、Edge、Safari（最新版本）
- 移动端浏览器也可使用，但建议在桌面端处理大文件

## 📂 项目结构

```
book-splitter/
├── src/
│   ├── components/              # React 组件
│   │   ├── FileUpload.tsx       # 文件上传组件（拖拽上传）
│   │   ├── ChapterList.tsx      # 章节列表组件（层级展示、选择、导出）
│   │   └── ChapterPreview.tsx   # 章节预览组件（悬浮预览）
│   ├── utils/                   # 工具函数
│   │   ├── pdfProcessor.ts      # PDF 处理（解析大纲、提取页面、渲染预览）
│   │   ├── epubProcessor.ts     # EPUB 处理（解析 NCX/nav、提取内容）
│   │   ├── epubToPdf.ts         # EPUB 转 PDF（html2canvas + jsPDF）
│   │   └── filenameUtils.ts     # 文件名工具（层级命名、转义字符）
│   ├── App.tsx                  # 主应用组件（状态管理、导出逻辑）
│   ├── main.tsx                 # 应用入口
│   └── App.css                  # 应用样式
├── public/                      # 静态资源
├── package.json                 # 项目配置
├── tsconfig.json               # TypeScript 配置
├── vite.config.ts              # Vite 配置
├── tailwind.config.js          # TailwindCSS 配置
└── CLAUDE.md                   # Claude Code 指南
```

## 🚀 技术亮点

### 核心算法
- **层级章节解析**：递归算法构建完整的父子章节树结构
- **智能页码计算**：叶子节点计算实际页码范围，父节点继承子节点边界
- **锚点内容提取**：EPUB 支持基于锚点的章节内容精准提取

### 性能优化
- **文件缓存机制**：避免重复读取相同的 EPUB 文件内容
- **进度节流更新**：每 100ms 最多更新一次，减少 UI 重绘
- **批处理加载**：EPUB 章节按批次（10个）并行加载
- **预览缓存**：章节预览内容缓存，避免重复渲染

### 导出策略
- **智能任务组织**：根据选择和合并模式动态生成导出任务
- **层级文件命名**：自动生成带序号的层级文件名
- **父章节独立内容处理**：检测并导出父章节在子章节之前的独立内容
- **ZIP 压缩打包**：多文件自动打包为 ZIP，最大压缩率

## 📝 开发指南

查看 [CLAUDE.md](./CLAUDE.md) 了解详细的架构说明和开发指南。

## License

MIT
